{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4 text-center">
    <div class="row">
        <div class="col-md-4">
            <h2 class="text-center">CartÃ£o de CrÃ©dito</h2>
                <div class="card mt-3">
                <h4 class="card-title mt-3 text-center ">MÃªs de: {{mes_atual}}     </h4>

                    <table class="table table-hover" id="compras_extrato" style="border-radius : 10px;">
                        <thead class=>
                            <tr>                      
                                <th>Marca </th>
                                <th>Saldo </th>
                                <th>Limite </th>

                            </tr>
                        </thead>
                        <tbody>
                        {%for c in cartao_obj %}
                
                            <tr> 
                            <td><a class="link-offset-2 link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover" href="{%url 'atualizar_cartao' c.id %}" >{{c.Marca}}  </a></td>
                                <td>{{c.saldo_cartao}}</td>  
                                <td>{{c.limite}}</td>  
                                
                            </tr>
                         {%endfor%} 	
                           
                        </tbody>
        
                    </table>
            <div class='row m-lg-2  '>
                    <div class='col px-lg-5'>
                        <button class="btn btn-primary text-white"  data-toggle="modal" data-target="#myModal"> Adicionar CartÃ£o </button>

                    </div>
            </div>


<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
    <div class="modal-content">
        <div class="modal-header">
        <h5 class="modal-title" id="myModalLabel">Adicionando CrÃ©dito</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
        <span aria-hidden="true">&times;</span>
        </button>
        </div>
        <form method="post">
            {% csrf_token %}
            <div class="form-group">
        <div class ='p-1'>
            {{form_cartao.as_p}}
        </div>

        <div class ='p-1'>
        <button type="submit" class="btn btn-primary text-white" >Adicionar CrÃ©dito </button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
        </div>
        </form>
        
    </div>
    </div>
    </div>

</div> 
            </div>
        </div>
        <div class="col-md-4">
            <h2 class="text-center">Compras no Crédito</h2>
            <div class="card mt-3">
                <h4 class="card-title mt-3 text-center ">Mês de: {{mes_atual}}     </h4>
                <table class="table table-hover " id ="scrollable-table"style="border-radius : 10px;">
                    <thead >
                        <tr>               
                            <th> </th>
                            <th>Nome </th>
                            <th>Valor </th>
                            <th>Data </th>
                            <th> Cartão </th>

                        </tr>
                    </thead>
                    <tbody>
                        {%if not compras_cartao %}
                        <tr> 
                        <td> </td>
                        <td>Nenhuma </td>  
                        <td>Compra</td>  
                        <td>Registrada </td>  
                        <td> </td>  
                        </tr> 
                    
                    </tbody>
                    <a href="{%url 'add_compra' request.user.id  %}" class="btn btn-danger text-white  px-lg-5" > Adicionar Compra </a>
    
                </table>
                
            </div>
        </div>
            
                {%else%}



                {%for c in compras_cartao %}
        
                    <tr> 
                    <td> <a href="{%url 'delete' c.id  'cartoes' %}" > <i class=" text-danger bi bi-x-square "></i> </a> </td>
                    <td><a class="link-offset-2 link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover" href="{%url 'atualizar_compras' c.id  %}" >{{c.nome}}  </a></td>
                    
                        <td class="text-danger"> <strong>{{c.valor}}</strong></td>
                        <td class="text-danger"> <strong>{{c.data|date:'d/m/y'}}</strong></td>  
                        <td class="text-danger"> <strong>{{c.cartao_credito}}</strong></td>  



                        
                        </tr>
                {%endfor%} 	
                    
                    </tbody>

                </table>

                <p> Saldo dos CartÃµes: {{total_saldo}} <p>

                    <a href="{%url 'add_compra' request.user.id  %}" class="btn btn-danger text-white  px-lg-5" > Adicionar Compra </a>
                    <a href="{%url 'extrato_compras' request.user.id  %}" target="_blank " class="btn btn-primary text-white  px-lg-5" > Abrir extrato </a>

            </div>
           
        </div>

        {%endif%}
            
        <div class="col-md-4">
            <h2 class="text-center">Consumo de CrÃ©dito</h2>
            <div class="card mt-3">
                <h4 class="card-title mt-3 text-center ">MÃªs de: {{mes_atual}}     </h4>
                <canvas id="pie-chart"></canvas>
   	 </div>
    
            </div>
        </div>
    </div>
</div>

<script>

    <script>
      
      
    document.addEventListener('DOMContentLoaded', function() {
        var data = {


             labels: ['Saldo CartÃµes','Compras feitas'],
            datasets: [{
                data: [{{total_saldo}},{{total_compras}}],
                        backgroundColor: ['blue','red']
                    }]
                };
           
               
                

        var ctx = document.getElementById('pie-chart').getContext('2d');
        var chart = new Chart(ctx, {
            type: 'pie',
            data: data,
            options: {
                title: {
                    display: true,
                    text: 'Meu GrÃ¡fico de Despesas e Receitas',
                    fontSize: 16,
                    fontColor: 'black',
                    fontFamily:'arial black '
                },
                elements: {
                    arc: {
                        borderWidth: 0
                    }
                },
                legend: {
                    display: true,
                    position: 'bottom',
                    labels: {
                        fontColor: 'black',
                        fontSize: 12
                    }
                }
            }
        });
    });

    const table = document.querySelector('#scrollable-table');

    // Define a altura máxima da tabela (em pixels)
    const maxHeight = 300;

    // Adiciona a rolagem apenas se a altura da tabela exceder maxHeight
    if (table.clientHeight > maxHeight) {
        table.style.overflowY = 'scroll'; // Adiciona a rolagem vertical
        table.style.maxHeight = maxHeight + 'px'; // Define a altura máxima
    }
</script>


{% endblock %}
